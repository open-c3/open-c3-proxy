#!/usr/bin/env perl

my ( $addr, $port ) = @ARGV;
die "error argv" unless $addr && $port && $addr =~ /^[a-z0-9\.\-]+$/ && $port =~ /^\d+$/;

my $path = "/data/open-c3-proxy";
my $conf = "$path/data/nginx.$addr.$port.conf";

system "cp $path/conf/nginx.conf $conf";
system "sed -i 's/SERVERADDR/$addr/g' $conf";
exec "docker run --name openc3-proxy-$addr-$port -p $port:80 -v $conf:/etc/nginx/nginx.conf:ro -v /data/open-c3-proxy/cache:/data -d nginx";
